<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Manage Users & Purchases</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans p-8">

  <h1 class="text-3xl font-bold mb-6">Users & Their Purchases</h1>

  <table class="min-w-full table-auto border-collapse border border-gray-700">
    <thead>
      <tr class="bg-gray-800">
        <th class="border border-gray-600 px-4 py-2">User ID</th>
        <th class="border border-gray-600 px-4 py-2">Name</th>
        <th class="border border-gray-600 px-4 py-2">Email</th>
        <th class="border border-gray-600 px-4 py-2">Password</th>
        <th class="border border-gray-600 px-4 py-2">Purchases</th>
        <th class="border border-gray-600 px-4 py-2">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr class="hover:bg-gray-700 align-top">
        <td class="border border-gray-600 px-4 py-2">{{ user.id }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ user.name }}</td>
        <td class="border border-gray-600 px-4 py-2">{{ user.email }}</td>
        <td class="border border-gray-600 px-4 py-2 text-center">********</td>
        <td class="border border-gray-600 px-4 py-2">
          {% if user.purchases %}
            <ul class="list-disc ml-5">
              {% for p in user.purchases %}
                <li class="mb-2">
                  <strong>{{ p.package_name }}</strong> - ${{ p.package_price }}<br />
                  Purchased: {{ p.created_at.strftime('%Y-%m-%d') }}<br />
                  <form action="{{ url_for('delete_purchase', purchase_id=p.id) }}" method="POST" class="inline" onsubmit="return confirm('Delete this purchase?');">
                    <button type="submit" class="text-red-500 hover:underline bg-transparent border-0 p-0 cursor-pointer">Delete Purchase</button>
                  </form>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            No purchases
          {% endif %}
        </td>
        <td class="border border-gray-600 px-4 py-2 text-center">
          <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" onsubmit="return confirm('Delete this user and all their purchases?');">
            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Delete User</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
